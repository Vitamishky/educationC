### Максимальное количество потоков в x32-процессе, 4 ГБ адресного пространства

#### 1. Теоретический расчет

**Исходные данные:**
- Размер виртуального адресного пространства: 4 ГБ (2³² байт)
- Типичный размер стека потока: 
  - Windows: 1 МБ (по умолчанию)
  - Linux: 2-10 МБ (обычно 8 МБ)


```
Макс. потоков = (Общее адр. пространство - Память под код/данные) / Размер стека потока
```

**Расчет для Windows (1 МБ стек):**
- Доступно для стеков: ~3 ГБ (остальное - ядро, код, данные)
- Макс. потоков = 3 ГБ / 1 МБ = 3072

**Расчет для Linux (8 МБ стек):**
- Доступно для стеков: ~3 ГБ
- Макс. потоков = 3 ГБ / 8 МБ = 384

#### 2. Практические ограничения

Факторы, уменьшающие количество:
1. **Память под код и данные процесса** (~500 МБ-1 ГБ)
2. **Оверхеды ядра** (~50-100 МБ)
3. **Ограничения ОС**:
   - Windows: 2048 потоков на процесс (x86)
   - Linux: зависит от `ulimit -u` (обычно 1024-4096)

**Практические максимумы:**
- Windows: 500-2000 потоков
- Linux: 250-500 потоков (при 8 МБ стеке)

#### 3. Критические ограничения

1. **Фрагментация адресного пространства**:
   - Нельзя использовать все 3 ГБ непрерывно
2. **Потребление нестековой памяти**:
   - Каждый поток требует структур ядра
3. **Переключение контекста**:
   - При >500 потоках производительность резко падает

#### 4. Рекомендации

1. **Оптимальное количество**:
   - Обычно 50-200 потоков на x32 процесс
2. **Уменьшение стека**:
   - Windows: `_beginthreadex` с явным указанием размера
   - Linux: `pthread_attr_setstacksize`
3. **Архитектурные решения**:
   - Использование пулов потоков
   - Переход на x64 для большего адресного пространства

**Вывод**: Теоретический максимум - 2000-3000 потоков, но практический лимит обычно 500-1000 из-за ограничений ОС и падения производительности.
